name: AOCAgent

on:
  workflow_dispatch:
  schedule:
    - cron: '15 5 * * *'  # Every day at 00:15 EST (05:15 UTC)

jobs:
  aoc-agent:
    name: AOC Agent Execution
    runs-on: ubuntu-latest
    timeout-minutes: 35

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          submodules: true

      - name: Setup Java 25 with GraalVM
        uses: actions/setup-java@v5
        with:
          distribution: 'graalvm'
          java-version: '25'

      - name: Setup jbang
        run: |
          curl -Ls https://sh.jbang.dev | bash -s - app setup
          echo "$HOME/.jbang/bin" >> $GITHUB_PATH

      - name: Execute AOC Agent
        env:
          CURSOR_API_KEY: ${{ secrets.CURSOR_API_KEY }}
        run: |
          jbang trust add https://github.com/jabrena/
          jbang churrera@jabrena run --workflow churrera-recipes/aoc/workflow.xml --show-logs --delete-on-success-completion --polling-interval 10
