<?xml version="1.0" encoding="UTF-8"?>
<prompt xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="https://jabrena.github.io/pml/schemas/0.3.0/pml.xsd">

    <title>Fix Sonar issues for the project</title>

    <role>You are a Senior software engineer with extensive experience in Java software development</role>

    <goal>
        Fix Sonar issues for the project.
        Follow the next steps to achieve the goal.
    </goal>

    <steps>
        <step number="1">
            <step-title>Install Jbang and test the Sonar Search CLI</step-title>
            <step-content>
                First, verify the Sonar Search CLI is working with Jbang:

                ```bash
                jbang --version
                jbang trust add https://github.com/jabrena/
                jbang sonar-search.0.2.0-SNAPSHOT@jabrena --version
                ```
                </step-content>
            <step-constraints>
                <step-constraint-list>
                    <step-constraint>Do not invest time in planning</step-constraint>
                    <step-constraint>Only install the component with the given command</step-constraint>
                </step-constraint-list>
            </step-constraints>
        </step>
        <step number="2">
            <step-title>Download Sonar issues for the project</step-title>
            <step-content>
                Retrieve the list of Sonar Hotspots for the project using the following command:

                <![CDATA[
                ```bash
                jbang sonar-search.0.2.0-SNAPSHOT@jabrena \
                --project jabrena_advent-of-code --query hotspots --quiet
                ```
                ]]>

                The output is a JSON format with the list of hotspots and it has the following
                structure:

                ```json
                {
                "paging" : {
                "pageIndex" : 1,
                "pageSize" : 100,
                "total" : 13
                },
                "hotspots" : [ ],
                ...
                }
                ```

                and understand the hotspots node exist an array of hotspots.
                you need to put focus per hotspot object in the following object attributes.

                Take a look the following example:

                <![CDATA[
                ```json
                "component" : "jabrena_advent-of-code:2015/src/main/java/info/jab/aoc2015/day16/AuntSueDetector.java",
                "project" : "jabrena_advent-of-code",
                "securityCategory" : "dos",
                "vulnerabilityProbability" : "MEDIUM",
                "status" : "TO_REVIEW",
                "line" : 26,
                "message" : "Make sure the regex used here, which is vulnerable to polynomial runtime due to backtracking, cannot lead to denial of service.",
                ```
                ]]>

                the field message indicate what is the issue,
                the field component indicate where is the issue located,
                in the section "flows" offer details where the issue is located.
                if flows has multiple objects, offer details about locations where the issue is located.
            </step-content>
        </step>
        <step number="3">
            <step-title>Fix the Sonar issues</step-title>
            <step-content>
                Using that information, fix the project in the different maven modules.

                Verify the changes with:

                ```bash
                ./mvnw clean test
                ```

                Once the changes are verified,
                commit the changes and push the changes to the branch to create the PR.
            </step-content>
            <step-constraints>
                <step-constraint-list>
                    <step-constraint>Not any issue which is has the rule: java:S3776 (Cognitive Complexity of methods should not be too high)</step-constraint>
                    <step-constraint>Not any issue which is has the rule: java:S106 (Replace this use of System.out by a logger)</step-constraint>
                    <step-constraint>Not any issue which is has the rule: java:S112 (Replace generic exceptions with specific library exceptions or a custom exception.)</step-constraint>
                    <step-constraint>Not any issue which is has the rule: java:S107 (Methods should not have too many parameters)</step-constraint>
                </step-constraint-list>
            </step-constraints>
        </step>
    </steps>

    <output-format>
        <output-format-list>
            <output-format-item>Print the list of sonar hotspots with the following format per hotspot:
                component:
                rule:
                message:
                ---
            </output-format-item>
        </output-format-list>
    </output-format>

    <safeguards>
        <safeguards-list>
            <safeguards-item>verify the changes only with `./mvnw clean test`</safeguards-item>
        </safeguards-list>
    </safeguards>

    <acceptance-criteria>
        <acceptance-criteria-list>
            <acceptance-criteria-item>The Sonar issues are fixed</acceptance-criteria-item>
            <acceptance-criteria-item>The project is verified successfully with `./mvnw clean test`</acceptance-criteria-item>
            <acceptance-criteria-item>The changes are committed and pushed to the branch to create the PR</acceptance-criteria-item>
        </acceptance-criteria-list>
    </acceptance-criteria>
</prompt>
